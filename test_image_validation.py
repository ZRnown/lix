#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
测试图片验证功能
"""

import sys
import os
sys.path.insert(0, os.path.dirname(__file__))

from discuz_sentinel import DiscuzSentinel

def test_image_validation():
    """测试图片验证功能"""
    sentinel = DiscuzSentinel()
    
    # 测试不同类型的数据
    test_cases = [
        ("有效PNG", b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x00\x01\x00\x00\x00\x01\x08\x02\x00\x00\x00\x90wS\xde\x00\x00\x00\tpHYs\x00\x00\x0b\x13\x00\x00\x0b\x13\x01\x00\x9a\x9c\x18\x00\x00\x00\nIDATx\x9cc\xf8\x00\x00\x00\x01\x00\x01]\xdbF\x0e\x00\x00\x00\x00IEND\xaeB`\x82'),
        ("有效JPEG", b'\xFF\xD8\xFF\xE0\x00\x10JFIF\x00\x01\x01\x01\x00H\x00H\x00\x00\xFF\xC0\x00\x11\x08\x00\x01\x00\x01\x01\x01\x11\x00\x02\x11\x01\x03\x11\x01\xFF\xC4\x00\x14\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\xFF\xC4\x00\x14\x10\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xFF\xDA\x00\x0C\x03\x01\x00\x02\x11\x03\x11\x00\x3F\x00\x00\x00\x00\xFF\xD9'),
        ("有效GIF", b'GIF89a\x01\x00\x01\x00\x80\x00\x00\x00\x00\x00\x00\x00\x00!\xf9\x04\x01\x00\x00\x00\x00,\x00\x00\x00\x00\x01\x00\x01\x00\x00\x02\x02D\x01\x00;'),
        ("HTML页面", b'<!DOCTYPE html><html><head><title>Test</title></head><body>Hello</body></html>'),
        ("空数据", b''),
        ("太小的数据", b'123'),
        ("无效数据", b'invalid image data here')
    ]
    
    print("测试图片验证功能:")
    print("=" * 50)
    
    for name, data in test_cases:
        result = sentinel._is_valid_image(data)
        status = "✅ 有效" if result else "❌ 无效"
        print("20")

if __name__ == "__main__":
    test_image_validation()
